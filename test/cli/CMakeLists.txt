macro(sourcemeta_registry_test_cli program name)
  if(UNIX)
    add_test(NAME registry.${program}.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/${program}/${name}.sh"
      "$<TARGET_FILE:sourcemeta_registry_${program}>"
      "${REGISTRY_VERSION}"
      WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}")
    set_tests_properties(registry.${program}.${name} PROPERTIES
      ENVIRONMENT "REGISTRY_PREFIX=${REGISTRY_PREFIX}")
  endif()
endmacro()

if(REGISTRY_INDEX)
  sourcemeta_registry_test_cli(index bundle-ref-no-fragment)
  sourcemeta_registry_test_cli(index extend-builtin-not-found)
  sourcemeta_registry_test_cli(index external-reference)
  sourcemeta_registry_test_cli(index invalid-configuration)
  sourcemeta_registry_test_cli(index invalid-schema)
  sourcemeta_registry_test_cli(index invalid-schema-top-level-ref-draft7)
  sourcemeta_registry_test_cli(index invalid-schema-uri-percentage)
  sourcemeta_registry_test_cli(index invalid-url-option-relative)
  sourcemeta_registry_test_cli(index invalid-url-option-urn)
  sourcemeta_registry_test_cli(index invalid-url-option-non-http)
  sourcemeta_registry_test_cli(index invalid-url-option-no-value)
  sourcemeta_registry_test_cli(index output-non-directory)
  sourcemeta_registry_test_cli(index extra-files-on-rebuild)
  sourcemeta_registry_test_cli(index extra-directories-on-rebuild)
  sourcemeta_registry_test_cli(index directory-schema-same-name)
  sourcemeta_registry_test_cli(index rebuild-cache)
  sourcemeta_registry_test_cli(index rebuild-to-empty)
  sourcemeta_registry_test_cli(index top-level-self)
  sourcemeta_registry_test_cli(index verbose-long)
  sourcemeta_registry_test_cli(index verbose-short)
  sourcemeta_registry_test_cli(index no-options)
  sourcemeta_registry_test_cli(index no-output)
endif()
